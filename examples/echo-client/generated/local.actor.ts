// DO NOT EDIT.
// Generated by actr-ts-codegen.

import type { Context, RpcEnvelope } from '../../../dist/index.js';
import type { PayloadType } from '../../../dist/index.js';
import { ECHO_ROUTE_KEY } from './echo.client';
import { ECHOTWICE_ROUTE_KEY } from './echo_twice.client';

const RPC_TIMEOUT_MS = 15000;
const RPC_PAYLOAD_TYPE: PayloadType = 0;

const ROUTES = [
  {
    routeKey: ECHO_ROUTE_KEY,
    targetType: {"manufacturer":"acme","name":"EchoService"},
  },
  {
    routeKey: ECHOTWICE_ROUTE_KEY,
    targetType: {"manufacturer":"acme","name":"EchoTwiceService"},
  },
];

export async function dispatchLocalActor(
  ctx: Context,
  envelope: RpcEnvelope
): Promise<Buffer> {
  const match = ROUTES.find((route) => route.routeKey === envelope.routeKey);
  if (!match) {
    throw new Error(`Unknown route: ${envelope.routeKey}`);
  }

  const targetId = await ctx.discover(match.targetType);
  return await ctx.callRaw(
    targetId,
    envelope.routeKey,
    RPC_PAYLOAD_TYPE,
    envelope.payload,
    RPC_TIMEOUT_MS
  );
}